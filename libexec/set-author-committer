#!/bin/sh

# Export variable to git subshell to prevent recursion
[ -n "$HOOK_FIRED" ] && exit 0
export HOOK_FIRED=YES

# Set this commit's committer
git config --local user.email $(pear get-committer)
git config --local user.name $(pear get-committer | cut -d '@' -f 1)
 

# Save current author before cycling through the list
author=$(pear get-author)
username=$(pear get-username $author)
name=$(pear get-full-name $username)

pear cycle

# Get next author so that we can construct Pear name
next_author=$(pear get-author)
next_username=$(pear get-username $next_author)
next_name=$(pear get-full-name $next_username)

pear_name="$name & $next_name"

echo $pear_name
# The commit line must run last.
git commit --allow-empty --amend --author "$pear_name <$author>" --no-edit --quiet 
